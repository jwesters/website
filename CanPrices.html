<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Daily Price Guess DLE</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 20px; background: #f0f2f5; }
  .card { background: white; padding: 20px; max-width: 600px; margin: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
  img { width: 80%; max-height: 250px; object-fit: contain; border-radius: 8px; margin: 10px 0; }
  input[type="number"] { padding: 10px; width: 150px; font-size: 16px; margin-top: 10px; }
  button { padding: 10px 20px; font-size: 16px; margin-top: 10px; cursor: pointer; }
  .hidden { display: none; }
  .feedback { font-size: 16px; margin-top: 15px; white-space: pre-line; text-align: left; }
</style>
</head>
<body>

<div class="card" id="gameCard">
  <h2>Daily Price Guess üá®üá¶</h2>
  <p>Guess how much this item cost in <strong>2015</strong> (CAD)</p>
  <img id="itemImg" src="" alt="Item Image" onerror="this.src='https://via.placeholder.com/400x300?text=Item+Image'">
  <h3 id="itemName"></h3>
  <p>Price in 2025: $<span id="price2025"></span></p>
  <input type="number" id="guessInput" placeholder="Your guess ($)" min="0" step="0.01">
  <br>
  <button onclick="submitGuess()">Submit Guess</button>
  <p class="feedback" id="feedbackText"></p>
  <p>Guesses left: <span id="guessesLeft">5</span></p>
</div>

<div class="card hidden" id="endCard">
  <h2>üìä Results</h2>
  <p>You made <strong id="finalGuesses"></strong> guesses.</p>
  <p>Actual 2015 price: $<strong id="actual2015"></strong></p>
  <h3>üèÜ Share Your Score</h3>
  <textarea id="shareText" rows="10" style="width: 90%;" readonly></textarea>
  <br>
  <button onclick="copyShare()">Copy Score</button>
</div>

<script>
// ---- Items ----
const items = [
  {name:"Bread (675g)", price2015:2.84, price2025:3.53, query:"bread"},
  {name:"Eggs (1 dozen)", price2015:3.32, price2025:4.92, query:"eggs"},
  {name:"Milk (1 L)", price2015:2.49, price2025:5.38, query:"milk"},
  {name:"White rice (2 kg)", price2015:6.50, price2025:9.45, query:"white rice"},
  {name:"Butter (454g)", price2015:4.61, price2025:5.75, query:"butter"},
  {name:"Apples (1 kg)", price2015:3.73, price2025:5.44, query:"apples"},
  {name:"Bananas (1 kg)", price2015:1.67, price2025:1.67, query:"bananas"},
  {name:"Coffee (300g)", price2015:6.50, price2025:6.70, query:"coffee"},
  {name:"Ground beef (1 kg)", price2015:12.66, price2025:13.85, query:"ground beef"},
  {name:"Toilet paper (12 rolls)", price2015:7.50, price2025:12.00, query:"toilet paper"}
];

// ---- Daily Seed ----
const today = new Date().toISOString().split("T")[0];
const seed = today.split("-").join("");
const index = parseInt(seed) % items.length;
const dailyItem = items[index];

// ---- Game State ----
let guessesLeft = 5;
let history = [];

document.getElementById("itemName").textContent = dailyItem.name;
document.getElementById("price2025").textContent = dailyItem.price2025.toFixed(2);

// ---- Unsplash dynamic image with placeholder fallback ----
const imgElement = document.getElementById("itemImg");
imgElement.src = "https://source.unsplash.com/400x300/?" + encodeURIComponent(dailyItem.query);
imgElement.onerror = () => {
  imgElement.src = 'https://via.placeholder.com/400x300?text=Item+Image';
};

// ---- Guess Handling ----
function submitGuess() {
  const guessBox = document.getElementById("guessInput");
  const guess = parseFloat(guessBox.value);
  if (isNaN(guess)) return;

  const lowerBound = dailyItem.price2015 * 0.95; // ¬±5%
  const upperBound = dailyItem.price2015 * 1.05;

  let result = "";
  if (guess >= lowerBound && guess <= upperBound) {
    result = "üéâ Close enough!";
    guessesLeft = 0;
  } else if (guess < dailyItem.price2015) {
    result = "Higher";
    guessesLeft--;
  } else {
    result = "Lower";
    guessesLeft--;
  }

  history.push({ guess, result });

  // Update feedback
  const feedbackDiv = document.getElementById("feedbackText");
  let feedbackHTML = "";
  history.forEach((h, i) => {
    feedbackHTML += `Guess ${i + 1}: $${h.guess.toFixed(2)} ‚Üí ${h.result}\n`;
  });
  feedbackDiv.textContent = feedbackHTML;

  document.getElementById("guessesLeft").textContent = guessesLeft;
  guessBox.value = "";

  if (guessesLeft === 0 || result === "üéâ Close enough!") {
    endGame();
  }
}

// ---- End Game ----
function endGame() {
  document.getElementById("gameCard").classList.add("hidden");
  document.getElementById("endCard").classList.remove("hidden");

  const price2015 = dailyItem.price2015;
  const price2025 = dailyItem.price2025;
  const diff = price2025 - price2015;
  const percentChange = ((diff / price2015) * 100).toFixed(1);

  document.getElementById("actual2015").textContent = price2015.toFixed(2);
  document.getElementById("finalGuesses").textContent = history.length;

  let share = `Price Guess DLE üá®üá¶\n${dailyItem.name} (2015 guess challenge)\n`;
  history.forEach((h, i) => {
    share += `Guess ${i + 1}: $${h.guess.toFixed(2)} ‚Üí ${h.result}\n`;
  });
  share += `Actual 2015 price: $${price2015.toFixed(2)}\n`;
  share += `2025 price: $${price2025.toFixed(2)} (${diff >=0 ? '+' : ''}$${diff.toFixed(2)}, ${diff >=0 ? '+' : ''}${percentChange}%)\n`;

  document.getElementById("shareText").value = share;
}

function copyShare() {
  navigator.clipboard.writeText(document.getElementById("shareText").value);
  alert("Copied!");
}
</script>
</body>
</html>
