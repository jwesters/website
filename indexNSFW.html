<!DOCTYPE html>    
<html lang="en">   
<head>    
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>https://github.com/jwesters/ Website Repo</title>
<style>
  :root { color-scheme: light; }
  body { font-family: Arial, sans-serif; padding: 28px; background:#f7f7f7; }
  h1 { margin: 0 0 8px; font-size: 22px; }
  p  { margin: 0 0 18px; color:#333; }
  .panel { background:#fff; border-radius:12px; padding:18px 18px 10px; box-shadow: 0 4px 14px rgba(0,0,0,.06); }
  details { margin: 10px 0; border: 1px solid #eee; border-radius: 10px; background:#fafafa; }
  summary { cursor:pointer; padding: 10px 12px; font-weight: 700; user-select:none; list-style:none; }
  summary::-webkit-details-marker { display:none; }
  summary::before { content:"â–¸"; display:inline-block; width: 18px; color:#666; }
  details[open] summary::before { content:"â–¾"; }
  ul { list-style:none; padding: 0 0 10px 0; margin: 0; }
  li { padding: 6px 12px; }
  a { text-decoration:none; color:#0066cc; }
  a:hover { text-decoration:underline; }
  .muted { color:#777; font-weight:400; margin-left:6px; font-size: 0.9em; }
  .icon { display:inline-block; width: 22px; }
  .nested { padding-left: 14px; }
  .root-files { margin: 6px 0 14px; border: 1px solid #eee; border-radius: 10px; background:#fafafa; }
  .root-files ul { padding-bottom: 6px; }
  .footer { margin-top: 14px; font-size: 0.95em; color:#666; }
</style>
</head>
<body>
  <h1>
    <a href="https://github.com/jwesters/website" target="_blank" rel="noopener noreferrer">
      https://github.com/jwesters/ Website Repo
    </a>
  </h1>
  <p>Auto-generated list of HTML files in this repository (folder tree & sorted).</p>

  <div class="panel">
    <div id="status" class="muted">Loadingâ€¦</div>
    <div id="groups"></div>
    <div id="lastUpdated" class="footer"></div>
  </div>

<script>
(() => {
  const OWNER = "jwesters";
  const REPO  = "website";
  const SITE_URL = `https://${OWNER}.github.io/${REPO}`;
  const API_BASE = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;

  // Options
  const HIDE_ROOT_INDEX_HTML = true;
  const HIDE_ALL_INDEX_HTML  = false;

  // --- Hide specific files (anywhere)
  const HIDE_EXACT_FILES = new Set([
    "indexnsfw.html"
  ]);

  // --- Icon mapping
  const ICON_RULES = [
    { re: /(tetris)/i, icon: "ðŸ§±" },
    { re: /(hangman)/i, icon: "ðŸª“" },
    { re: /(maze)/i, icon: "ðŸ§©" },
    { re: /(qr|qrcode)/i, icon: "ðŸ”³" },
    { re: /(wordle|numdle|dle)/i, icon: "ðŸŸ©" },
    { re: /(card|deck)/i, icon: "ðŸƒ" },
    { re: /(clock|time)/i, icon: "â°" },
    { re: /(math|quiz)/i, icon: "âž—" },
    { re: /(game|play)/i, icon: "ðŸŽ®" },
    { re: /(index)/i, icon: "ðŸ " },
  ];
  const DEFAULT_FOLDER_ICON = "ðŸ“";
  const DEFAULT_FILE_ICON   = "ðŸ“„";

  const statusEl = document.getElementById("status");
  const groupsEl = document.getElementById("groups");
  const lastUpdatedEl = document.getElementById("lastUpdated");

  function displayName(fileName) {
    // Remove "NSFW-" from what the user sees (case-insensitive), without changing the link URL/path.
    return String(fileName).replace(/^nsfw-/i, "");
  }

  function iconFor(displayText, isDir) {
    const hit = ICON_RULES.find(r => r.re.test(displayText));
    if (hit) return hit.icon;
    return isDir ? DEFAULT_FOLDER_ICON : DEFAULT_FILE_ICON;
  }

  // --- Tree model
  const tree = { name: "", path: "", files: [], dirs: new Map() };

  function getOrCreateDir(parent, dirName, fullPath) {
    if (!parent.dirs.has(dirName)) {
      parent.dirs.set(dirName, { name: dirName, path: fullPath, files: [], dirs: new Map() });
    }
    return parent.dirs.get(dirName);
  }

  function addFileToTree(filePath) {
    const parts = filePath.split("/").filter(Boolean);
    const fileName = parts.pop();
    let node = tree;
    let accum = "";
    for (const dir of parts) {
      accum = accum ? `${accum}/${dir}` : dir;
      node = getOrCreateDir(node, dir, accum);
    }
    node.files.push({ name: fileName, path: filePath });
  }

  function shouldHide(filePath) {
    const lowerPath = String(filePath).toLowerCase();

    // Hide index files per existing options
    if (HIDE_ALL_INDEX_HTML && lowerPath.endsWith("/index.html")) return true;
    if (HIDE_ROOT_INDEX_HTML && lowerPath === "index.html") return true;

    // Hide indexNSFW.html anywhere in the repo
    const base = lowerPath.split("/").pop();
    if (HIDE_EXACT_FILES.has(base)) return true;

    return false;
  }

  async function fetchFiles(path = "") {
    const url = path ? `${API_BASE}/${encodeURIComponent(path)}` : API_BASE;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);
    const items = await res.json();

    for (const item of items) {
      if (item.type === "dir") {
        await fetchFiles(item.path);
      } else if (item.type === "file" && item.name.toLowerCase().endsWith(".html")) {
        if (!shouldHide(item.path)) addFileToTree(item.path);
      }
    }
  }

  function sortAlpha(a, b) {
    return a.localeCompare(b, undefined, { sensitivity: "base" });
  }

  function countHtml(node) {
    let count = node.files.length;
    for (const child of node.dirs.values()) count += countHtml(child);
    return count;
  }

  function pruneEmptyDirs(node) {
    for (const [name, child] of Array.from(node.dirs.entries())) {
      pruneEmptyDirs(child);
      if (countHtml(child) === 0) node.dirs.delete(name);
    }
  }

  function buildFileList(files) {
    const ul = document.createElement("ul");
    files.sort((a, b) => sortAlpha(a.name, b.name));
    for (const f of files) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = `${SITE_URL}/${f.path}`;
      a.target = "_blank";
      a.rel = "noopener noreferrer";

      const shown = displayName(f.name);
      a.innerHTML = `<span class="icon">${iconFor(shown, false)}</span>${shown}`;

      li.appendChild(a);
      ul.appendChild(li);
    }
    return ul;
  }

  function renderDir(node) {
    const details = document.createElement("details");
    const summary = document.createElement("summary");
    summary.innerHTML = `<span class="icon">${iconFor(node.name, true)}</span>${node.name} <span class="muted">(${countHtml(node)})</span>`;
    details.appendChild(summary);

    const wrap = document.createElement("div");
    wrap.className = "nested";

    if (node.files.length) wrap.appendChild(buildFileList(node.files));

    for (const name of Array.from(node.dirs.keys()).sort(sortAlpha)) {
      wrap.appendChild(renderDir(node.dirs.get(name)));
    }

    details.appendChild(wrap);
    return details;
  }

  function buildUI() {
    statusEl.textContent = "";
    pruneEmptyDirs(tree);

    if (tree.files.length) {
      const box = document.createElement("div");
      box.className = "root-files";
      box.appendChild(buildFileList(tree.files));
      groupsEl.appendChild(box);
    }

    for (const name of Array.from(tree.dirs.keys()).sort(sortAlpha)) {
      groupsEl.appendChild(renderDir(tree.dirs.get(name)));
    }
  }

  async function setLastUpdated() {
    try {
      const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/commits?path=index.html&per_page=1`);
      const data = await res.json();
      const iso = data?.[0]?.commit?.committer?.date;
      if (!iso) return;
      const d = new Date(iso);
      lastUpdatedEl.textContent =
        "Last updated: " +
        new Intl.DateTimeFormat("en-CA", { year:"numeric", month:"long", day:"numeric" }).format(d);
    } catch {
      lastUpdatedEl.textContent = ""; 
    }
  }

  (async () => {
    try {
      statusEl.textContent = "Loadingâ€¦";
      await fetchFiles("");
      buildUI();
      await setLastUpdated();
    } catch (e) {
      console.error(e);
      statusEl.textContent = "Failed to load files.";
    }
  })();
})();
</script>

</body>
</html>
