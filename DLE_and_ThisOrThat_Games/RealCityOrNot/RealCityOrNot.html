<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weird City or Made Up?</title>
  <style>
    :root{
      --bg:#0f1220; --text:#e8ecff; --muted:#aeb6e6;
      --good:#38d39f; --bad:#ff5d6c; --warn:#ffd166;
      --ring: rgba(120,160,255,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(1100px 700px at 20% 10%, #1b2150 0%, transparent 60%),
                  radial-gradient(900px 600px at 90% 30%, #2a1b50 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:22px;
    }
    .wrap{width:min(860px,100%); display:grid; grid-template-columns:1fr; gap:18px; align-items:start;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      border-radius: 18px; overflow:hidden;
    }
    .hd{padding:18px 18px 10px; border-bottom:1px solid rgba(255,255,255,.07); background:linear-gradient(180deg, rgba(255,255,255,.05), transparent);}
    h1{font-size:22px; margin:0; letter-spacing:.3px;}
    .sub{margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.35;}
    .main{padding:18px;}
    .nameBox{
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding:18px;
      text-align:center;
      position:relative;
      outline: none;
    }
    .nameLabel{font-size:12px; color:var(--muted); margin-bottom:10px; letter-spacing:.18em; text-transform:uppercase;}
    .bigName{font-size: clamp(26px, 4.4vw, 44px); line-height:1.05; font-weight:800; margin:0; word-break:break-word;}
    .btnRow{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:16px;}
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      color:var(--text); border-radius:14px; padding:14px; font-weight:800; cursor:pointer;
      transition:transform .06s ease, border-color .2s ease, background .2s ease;
      user-select:none; text-align:center; letter-spacing:.2px;
    }
    .btn:focus{outline:none; box-shadow:0 0 0 4px var(--ring);}
    .btn:hover{border-color: rgba(160,190,255,.35); background: rgba(255,255,255,.06);}
    .btn:active{transform: translateY(1px);}
    .btn.good{border-color: rgba(56,211,159,.35);}
    .btn.bad{border-color: rgba(255,93,108,.35);}
    .btn.secondary{background: rgba(0,0,0,.2);}
    .btn.start{
      font-size: clamp(20px, 3.2vw, 28px);
      padding: 16px 18px;
      border-radius: 16px;
      border-color: rgba(160,190,255,.35);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      width: min(420px, 100%);
      margin: 0 auto;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .row{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-top:14px;}
    .score{display:flex; gap:14px; align-items:center; flex-wrap:wrap;}
    .stat{background: rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:10px 12px; min-width:160px; text-align:left;}
    .stat .k{color:var(--muted); font-size:12px;}
    .stat .v{font-size:20px; font-weight:900; margin-top:2px;}
    .toast{margin-top:12px; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.18); display:none; gap:10px; align-items:flex-start;}
    .dot{width:10px;height:10px;border-radius:50%; margin-top:4px; background:var(--muted);}
    .toast.good{display:flex; border-color: rgba(56,211,159,.25);} .toast.good .dot{background:var(--good);}
    .toast.bad{display:flex; border-color: rgba(255,93,108,.25);} .toast.bad .dot{background:var(--bad);}
    .toast.warn{display:flex; border-color: rgba(255,209,102,.25);} .toast.warn .dot{background:var(--warn);}
    code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    /* Modal */
    .overlay{position:fixed; inset:0; background: rgba(5,7,18,.72); backdrop-filter: blur(10px); display:none; align-items:center; justify-content:center; padding:20px; z-index:99;}
    .modal{width:min(720px,100%); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.12); border-radius:22px; box-shadow:0 25px 80px rgba(0,0,0,.55); overflow:hidden;}
    .modal .hd{padding:18px; border-bottom:1px solid rgba(255,255,255,.08); background: rgba(0,0,0,.18);}
    .modal h2{margin:0; font-size:26px;}
    .modal .bd{padding:18px;}
    .modal .big{font-size:54px; font-weight:1000; margin: 2px 0 0; line-height:1;}
    .modal .foot{padding:18px; border-top:1px solid rgba(255,255,255,.08); display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap; background: rgba(0,0,0,.12);}
    .table{width:100%; border-collapse:collapse; margin-top:10px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.08);}
    .table th,.table td{padding:10px; border-bottom:1px solid rgba(255,255,255,.06); font-size:12px; text-align:left;}
    .table th{color:var(--muted); font-weight:900; letter-spacing:.12em; text-transform:uppercase;}
    .table tr:last-child td{border-bottom:none;}

    /* Small */
    .mini{font-size:12px; color:var(--muted); line-height:1.35;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hd">
        <h1>Weird City or Made Up?</h1>
        <p class="sub">Guess if the name is a <b>real city/place</b> or <b>made up</b>. One wrong answer ends your streak.</p>
      </div>

      <div class="main">
        <div class="nameBox" tabindex="0">
          <div class="nameLabel">Name</div>

          <!-- START button lives exactly where the big name text goes -->
          <div id="startSlot">
            <button class="btn start" id="startBtn">‚ñ∂ Start</button>
          </div>

          <!-- Name display -->
          <p class="bigName" id="currentName" style="display:none;"></p>

          <div class="btnRow">
            <button class="btn good" id="btnReal" disabled>‚úÖ Real City / Place</button>
            <button class="btn bad" id="btnFake" disabled>üö´ Made Up</button>
          </div>

          <div id="toast" class="toast">
            <span class="dot"></span>
            <div class="mini" id="toastText"></div>
          </div>

          <div class="row">
            <div class="score">
              <div class="stat">
                <div class="k">Current streak</div>
                <div class="v" id="streak">0</div>
              </div>
              <div class="stat">
                <div class="k">Local best</div>
                <div class="v" id="best">‚Äî</div>
              </div>
            </div>

            <!-- Restart is hidden until first round starts (1B) -->
            <div id="restartWrap" style="display:none;">
              <button class="btn secondary" id="restartBtn">Restart</button>
            </div>
          </div>

          <!-- No footer "Loaded 2000 names..." line (removed per request) -->
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="hd">
        <h2 id="modalTitle">Game Over</h2>
        <div class="mini" id="modalSubtitle"></div>
      </div>
      <div class="bd" id="modalBody"></div>
      <div class="foot">
        <button class="btn secondary" id="closeModal">Close</button>
        <button class="btn" id="playAgain">Play again</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const el = (id) => document.getElementById(id);

  // --------------------
  // Single file to load
  // --------------------
  const LIST_FILE = "city_game_list.txt";

  // Fallback list (SFW) so the page still works if fetch fails
  const FALLBACK_LINES = [
    "R|Moose Jaw",
    "R|Truth or Consequences",
    "R|Wawa",
    "R|Flin Flon",
    "R|Boring",
    "F|Misty Pickle Junction",
    "F|Cedar Waffle Hollow",
    "F|Sunny Banjo Springs",
    "F|Hidden Marble Corners",
    "F|Silver Otter Ridge"
  ];

  // --------------------
  // Local Best (always ON ‚Äî 3A)
  // --------------------
  const STORAGE_KEY = "weirdcity_singlefile_best_v2";
  function loadBest(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed)) return [];
      return parsed.filter(x => typeof x.score === "number" && typeof x.ts === "number").slice(0,3);
    }catch(_){ return []; }
  }
  function saveBest(list){
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(list.slice(0,3))); }catch(_){}
  }
  function formatDate(ts){
    const d = new Date(ts);
    return d.toLocaleString(undefined, { year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit" });
  }

  // --------------------
  // Parse list file lines (SFW enforced)
  // --------------------
  function normalizeLine(s){
    return s.replace(/\uFEFF/g,"").trim();
  }

  // Lightweight SFW guard (prevents accidental slip-ups even if list file has issues)
  const BANNED = [
    "fuck","shit","cunt","porn","sex","dick","pussy","asshole","bitch","whore","slut",
    "cock","tits","boob","nipple","dildo","intercourse","anal","rape","nazi"
  ];
  function isSfwName(name){
    const lower = name.toLowerCase();
    return !BANNED.some(w => lower.includes(w));
  }

  function parseLine(line){
    const s = normalizeLine(line);
    if(!s || s.startsWith("#")) return null;

    // Format: R|Name  or  F|Name
    const m = s.match(/^([RF])\s*\|\s*(.+)$/i);
    if(!m) return null;

    const kind = m[1].toUpperCase();
    const name = m[2].trim();

    if(!name) return null;
    if(!isSfwName(name)) return null; // enforce SFW regardless

    return {
      name,
      answer: (kind === "R") ? "real" : "fake"
    };
  }

  async function loadFromFile(path){
    const res = await fetch(path, { cache: "no-store" });
    if(!res.ok) throw new Error(`Failed to load ${path} (${res.status})`);
    const text = await res.text();
    const items = [];
    const seen = new Set();
    text.split(/\r?\n/g).forEach(line => {
      const obj = parseLine(line);
      if(!obj) return;
      const key = obj.answer + "::" + obj.name.toLowerCase();
      if(seen.has(key)) return;
      seen.add(key);
      items.push(obj);
    });
    return items;
  }

  // --------------------
  // UI refs
  // --------------------
  const startSlot = el("startSlot");
  const startBtn = el("startBtn");
  const restartBtn = el("restartBtn");
  const restartWrap = el("restartWrap");

  const currentNameEl = el("currentName");
  const btnReal = el("btnReal");
  const btnFake = el("btnFake");
  const toast = el("toast");
  const toastText = el("toastText");
  const streakEl = el("streak");
  const bestEl = el("best");

  const overlay = el("overlay");
  const modalTitle = el("modalTitle");
  const modalSubtitle = el("modalSubtitle");
  const modalBody = el("modalBody");
  const closeModal = el("closeModal");
  const playAgain = el("playAgain");

  // --------------------
  // Game state
  // --------------------
  let pool = [];
  let streak = 0;
  let running = false;
  let current = null;
  let listSource = "file";
  let loadedOk = false;

  function showToast(kind, html){
    toast.className = "toast " + kind;
    toastText.innerHTML = html;
    toast.style.display = "flex";
  }
  function hideToast(){
    toast.className = "toast";
    toast.style.display = "none";
  }
  function setButtonsEnabled(on){
    btnReal.disabled = !on;
    btnFake.disabled  = !on;
  }
  function pickRandom(){
    return pool[Math.floor(Math.random()*pool.length)];
  }

  function renderBest(){
    const best = loadBest();
    bestEl.textContent = best.length ? String(best[0].score) : "‚Äî";
  }

  function initStartView(){
    // Start button shows where name would be
    startSlot.style.display = "block";
    currentNameEl.style.display = "none";
    currentNameEl.textContent = "";
    setButtonsEnabled(false);
    restartWrap.style.display = "none"; // 1B
    hideToast();
    streakEl.textContent = "0";
    renderBest();
  }

  async function init(){
    loadedOk = false;
    try{
      pool = await loadFromFile(LIST_FILE);
      listSource = "file";
      loadedOk = pool.length >= 20;
    }catch(err){
      console.warn(err);
      // fallback
      const seen = new Set();
      pool = FALLBACK_LINES.map(parseLine).filter(Boolean).filter(it => {
        const key = it.answer + "::" + it.name.toLowerCase();
        if(seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      listSource = "fallback";
      loadedOk = true; // at least playable
    }

    // Ensure both types exist; if not, pad from fallback (still SFW)
    const counts = pool.reduce((acc, it) => {
      acc[it.answer] = (acc[it.answer] || 0) + 1;
      return acc;
    }, {});
    if((counts.real || 0) < 5 || (counts.fake || 0) < 5){
      FALLBACK_LINES.forEach(line => {
        const it = parseLine(line);
        if(it) pool.push(it);
      });
    }

    initStartView();

    if(listSource === "fallback"){
      // Keep UI minimal; just a gentle hint via toast so user knows why.
      showToast("warn", `<b>Note:</b> Couldn‚Äôt load <code>${LIST_FILE}</code>. Using a small fallback list. Host this folder (GitHub Pages / Live Server) to load the full file.`);
      setTimeout(hideToast, 5200);
    }
  }

  function newRound(){
    current = pickRandom();
    currentNameEl.textContent = current.name;
    hideToast();
  }

  function startGame(){
    if(!loadedOk || !pool.length){
      showToast("bad", `<b>List not loaded.</b> Make sure <code>${LIST_FILE}</code> is beside this HTML and you‚Äôre hosting the folder (not <code>file://</code>).`);
      return;
    }
    streak = 0;
    running = true;
    streakEl.textContent = "0";

    // Start button disappears; name appears
    startSlot.style.display = "none";
    currentNameEl.style.display = "block";

    // Enable game buttons and show Restart (after first start) ‚Äî 1B
    setButtonsEnabled(true);
    restartWrap.style.display = "block";

    newRound();
  }

  function recordIfBest(score){
    const list = loadBest();
    const entry = { score, ts: Date.now() };
    list.push(entry);
    list.sort((a,b) => b.score - a.score || a.ts - b.ts);
    const top3 = list.slice(0,3);
    saveBest(top3);
    const rank = top3.findIndex(x => x.ts === entry.ts && x.score === entry.score);
    return { rank: rank >= 0 ? rank+1 : null };
  }

  function endGame(){
    running = false;
    setButtonsEnabled(false);

    modalTitle.textContent = "Game Over";
    const { rank } = recordIfBest(streak);
    renderBest();

    // Keep subtitle minimal; no ‚Äúloaded 2000 names‚Äù footer on main UI
    modalSubtitle.innerHTML = (listSource === "fallback")
      ? `Using a small fallback list.`
      : ``;

    const bestList = loadBest();
    const bestTable = `<table class="table">
      <thead><tr><th>Rank</th><th>Streak</th><th>When</th></tr></thead>
      <tbody>
        ${bestList.length ? bestList.map((x,i)=>`
          <tr><td>#${i+1}</td><td><b>${x.score}</b></td><td>${formatDate(x.ts)}</td></tr>
        `).join("") : `<tr><td colspan="3" style="color:var(--muted);">No saved scores yet.</td></tr>`}
      </tbody>
    </table>`;

    modalBody.innerHTML = `
      <div class="mini" style="color:var(--muted);">Your streak</div>
      <div class="big">${streak}</div>

      <div class="toast bad" style="display:flex; margin-top:12px;">
        <span class="dot"></span>
        <div class="mini"><b>Last name:</b> ${current?.name ?? "‚Äî"}</div>
      </div>

      ${rank ? `
        <div class="toast good" style="display:flex; margin-top:12px;">
          <span class="dot"></span>
          <div class="mini"><b>New record!</b> You‚Äôre #${rank}.</div>
        </div>` : ""}

      <div style="height:1px; background:rgba(255,255,255,.08); margin:12px 0;"></div>
      <div class="mini"><b>Local best</b></div>
      ${bestTable}
    `;

    overlay.style.display = "flex";
  }

  function handleGuess(guess){
    if(!running || !current) return;
    const correct = (guess === current.answer);
    if(correct){
      streak++;
      streakEl.textContent = String(streak);
      showToast("good", `<b>Correct!</b>`);
      setTimeout(newRound, 280);
    }else{
      showToast("bad", `<b>Wrong!</b>`);
      setTimeout(endGame, 120);
    }
  }

  function restart(){
    // Keep Restart visible (game already started once), but reset streak and continue
    streak = 0;
    running = true;
    streakEl.textContent = "0";
    setButtonsEnabled(true);
    hideToast();
    if(startSlot.style.display !== "none"){
      startSlot.style.display = "none";
      currentNameEl.style.display = "block";
    }
    newRound();
  }

  // Events
  startBtn.addEventListener("click", startGame);
  restartBtn.addEventListener("click", restart);
  btnReal.addEventListener("click", () => handleGuess("real"));
  btnFake.addEventListener("click", () => handleGuess("fake"));

  closeModal.addEventListener("click", () => overlay.style.display = "none");
  playAgain.addEventListener("click", () => { overlay.style.display = "none"; restart(); });
  overlay.addEventListener("click", (e) => { if(e.target === overlay) overlay.style.display = "none"; });

  // Keyboard: R/F/Enter
  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && overlay.style.display === "flex"){ overlay.style.display = "none"; return; }
    if(e.target && (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")) return;
    const k = e.key.toLowerCase();
    if(k === "r") handleGuess("real");
    if(k === "f") handleGuess("fake");
    if(k === "enter"){
      if(startSlot.style.display !== "none") startGame();
      else restart();
    }
  });

  // Boot
  init();
})();
</script>
</body>
</html>
