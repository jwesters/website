<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pick 10 Safe Letters</title>

<style>
:root { --bg:#0f172a; --text:#e5e7eb; }
*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: system-ui, sans-serif;
  background:#0f172a;
  color:var(--text);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

header{ text-align:center; padding:14px; }

.wrap{
  width:min(900px,92vw);
  margin:0 auto;
  flex:1;
  position:relative;
}

.panel{
  background:rgba(255,255,255,.05);
  border-radius:14px;
  padding:16px;
}

.status{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}

.word{
  text-align:center;
  font-size:34px;
  letter-spacing:6px;
  margin:20px 0 6px;
  font-weight:900;
}

.sub{
  text-align:center;
  opacity:.85;
  margin:0 0 16px;
  font-weight:700;
}

.stats{
  display:flex;
  justify-content:center;
  gap:14px;
  flex-wrap:wrap;
  margin:0 0 10px;
  opacity:.9;
  font-weight:800;
}

.badge{
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
}

.picked{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

.pill{
  padding:6px 10px;
  border-radius:999px;
  font-weight:800;
  background:#334155;
}
.pill.safe{ background:#16a34a; }
.pill.hit{ background:#dc2626; }

.keyboardWrap{ padding:12px; background:#020617; }

.keyboard{
  width:min(900px,92vw);
  margin:0 auto;
  display:grid;
  grid-template-columns:repeat(13,1fr);
  gap:6px;
}

.key{
  padding:10px 0;
  border-radius:10px;
  background:#334155;
  color:white;
  border:none;
  font-weight:800;
  cursor:pointer;
}
.key.safe{ background:#16a34a; }
.key.hit{ background:#dc2626; }
.key:disabled{ opacity:.55; cursor:not-allowed; }

button{
  padding:10px 16px;
  border-radius:12px;
  font-weight:900;
  border:none;
  cursor:pointer;
}

.primary{ background:#6366f1; color:white; }
.success{ background:#16a34a; color:white; }
.danger{ background:#dc2626; color:white; }
.secondary{ background:#475569; color:white; }

/* OVERLAY */
.overlay{
  position:absolute;
  inset:0;
  background:rgba(2,6,23,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.overlay.show{ display:flex; }

.overlayBox{
  background:#020617;
  padding:30px;
  border-radius:18px;
  text-align:center;
  min-width:320px;
}

.overlayBox h2{ margin:0 0 10px; font-size:32px; }

.overlayBox p{
  margin:0 0 20px;
  opacity:.9;
  font-weight:700;
  line-height:1.4;
  white-space:pre-line;
}

.overlayButtons{
  display:flex;
  gap:12px;
  justify-content:center;
}
</style>
</head>

<body>
<header>
  <h1>Pick 10 Safe Letters</h1>
  <p>
    Win: pick <b>10</b> letters <b>NOT</b> in the word.<br>
    Lose instantly if you either <b>spell the whole word</b> (reveal it) or pick <b>5 hit letters</b>.
  </p>
</header>

<main class="wrap">

  <!-- GAME OVER OVERLAY -->
  <div class="overlay" id="overlay">
    <div class="overlayBox">
      <h2 id="overlayTitle"></h2>
      <p id="overlayText"></p>
      <div class="overlayButtons">
        <button id="statusBtn" disabled></button>
        <button class="secondary" id="playAgainBtn">NEW GAME</button>
      </div>
    </div>
  </div>

  <section class="panel">
    <div class="status">
      <div id="progress"></div>
      <button class="primary" id="newGame">New Game</button>
    </div>

    <div class="word" id="wordDisplay"></div>

    <div class="stats">
      <span class="badge" id="safeStat"></span>
      <span class="badge" id="hitStat"></span>
      <span class="badge" id="revealStat"></span>
    </div>

    <div class="sub">Revealed letters are from hit picks.</div>

    <div class="picked" id="picked"></div>
  </section>
</main>

<div class="keyboardWrap">
  <div class="keyboard" id="keyboard"></div>
</div>

<script>
/* ================= CONFIG ================= */
const WORD_FILE = "./dictionary_least_common_10000.txt";
const SAFE_TO_WIN = 10;
const HIT_LOSE_LIMIT = 5;

/* ================= STATE ================= */
let words = [];
let answer = "";
let safePicks = 0;
let hitCount = 0;
let guessed = new Set();
let revealed = new Set();
let uniqueLettersInWord = new Set();
let gameOver = false;

/* ================= ELEMENTS ================= */
const wordDisplay = document.getElementById("wordDisplay");
const pickedEl = document.getElementById("picked");
const keyboardEl = document.getElementById("keyboard");
const progressEl = document.getElementById("progress");
const safeStat = document.getElementById("safeStat");
const hitStat = document.getElementById("hitStat");
const revealStat = document.getElementById("revealStat");

const overlay = document.getElementById("overlay");
const overlayTitle = document.getElementById("overlayTitle");
const overlayText = document.getElementById("overlayText");
const statusBtn = document.getElementById("statusBtn");

/* ================= LOAD WORDS ================= */
const WORD_URL = new URL(WORD_FILE, location.href).href;
console.log("Trying to load word list from:", WORD_URL);

fetch(WORD_URL + "?v=" + Date.now(), { cache: "no-store" })
  .then(async (res) => {
    if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText} for ${WORD_URL}`);
    return res.text();
  })
  .then(text => {
    words = text
      .split(/\r?\n/)
      .map(w => w.trim().toUpperCase())
      .filter(w => /^[A-Z]{3,12}$/.test(w));

    if (!words.length) throw new Error("Loaded file, but no valid words found.");
    console.log("Words loaded:", words.length);

    newGame();
  })
  .catch(err => {
    console.error(err);
    alert("Could not load word list:\n" + err.message);
  });

/* ================= GAME ================= */
function pickWord(){
  return words[Math.floor(Math.random() * words.length)];
}

function newGame(){
  if (!words.length) return;

  answer = pickWord();
  uniqueLettersInWord = new Set(answer.split("")); // unique letters in secret word

  safePicks = 0;
  hitCount = 0;
  guessed.clear();
  revealed.clear();
  gameOver = false;

  overlay.classList.remove("show");
  render();
}

function render(){
  progressEl.textContent = `Goal: ${SAFE_TO_WIN} safe letters`;

  // Show blanks; reveal letters that were hit-picked
  wordDisplay.textContent = answer
    .split("")
    .map(l => revealed.has(l) ? l : "_")
    .join(" ");

  safeStat.textContent = `Safe: ${safePicks}/${SAFE_TO_WIN}`;
  hitStat.textContent = `Hits: ${hitCount}/${HIT_LOSE_LIMIT}`;
  revealStat.textContent = `Revealed: ${revealed.size}/${uniqueLettersInWord.size}`;

  pickedEl.innerHTML = guessed.size
    ? [...guessed].sort().map(l => {
        const hit = answer.includes(l);
        return `<span class="pill ${hit ? "hit" : "safe"}">${l}</span>`;
      }).join("")
    : "<div style='opacity:.7;font-weight:700'>Picked letters will show here</div>";

  keyboardEl.innerHTML = "";
  for (let i = 65; i <= 90; i++) {
    const l = String.fromCharCode(i);
    const b = document.createElement("button");
    b.textContent = l;
    b.className = "key";
    b.disabled = guessed.has(l) || gameOver;

    if (guessed.has(l)) {
      b.classList.add(answer.includes(l) ? "hit" : "safe");
    }

    b.onclick = () => guess(l);
    keyboardEl.appendChild(b);
  }
}

function showOverlay(win, reason = ""){
  gameOver = true;
  overlay.classList.add("show");

  if (win){
    overlayTitle.textContent = "You Win!";
    overlayText.textContent = `You picked ${SAFE_TO_WIN} safe letters.\nThe word was: ${answer}`;
    statusBtn.textContent = "YOU WIN";
    statusBtn.className = "success";
  } else {
    overlayTitle.textContent = "You Lost";
    overlayText.textContent = `${reason}\nThe word was: ${answer}`;
    statusBtn.textContent = "YOU LOST";
    statusBtn.className = "danger";
  }

  render();
}

function loseIfSpelledWord(){
  // If you've revealed all unique letters in the word, the word is fully spelled/revealed
  if (revealed.size >= uniqueLettersInWord.size) {
    showOverlay(false, "You revealed the whole word!");
    return true;
  }
  return false;
}

function loseIfTooManyHits(){
  if (hitCount >= HIT_LOSE_LIMIT) {
    showOverlay(false, `You picked ${HIT_LOSE_LIMIT} letters that were in the word!`);
    return true;
  }
  return false;
}

function guess(letter){
  if (gameOver || guessed.has(letter) || !answer) return;

  guessed.add(letter);

  if (answer.includes(letter)){
    hitCount++;
    revealed.add(letter); // reveal that letter in the word

    // Loss conditions
    if (loseIfTooManyHits()) return;
    if (loseIfSpelledWord()) return;

  } else {
    safePicks++;
    if (safePicks >= SAFE_TO_WIN) {
      showOverlay(true);
      return;
    }
  }

  render();
}

/* ================= EVENTS ================= */
document.getElementById("newGame").onclick = newGame;
document.getElementById("playAgainBtn").onclick = newGame;

window.addEventListener("keydown", e => {
  const k = e.key.toUpperCase();
  if (/^[A-Z]$/.test(k)) guess(k);
});
</script>
</body>
</html>
