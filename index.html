<!DOCTYPE html>  
<html lang="en">   
<head>      
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" /> 
<title>https://github.com/jwesters/ Website Repo</title>
<style>
  :root { color-scheme: light; }
  body { font-family: Arial, sans-serif; padding: 28px; background:#f7f7f7; }
  h1 { margin: 0 0 8px; font-size: 22px; }
  p  { margin: 0 0 18px; color:#333; }
  .panel { background:#fff; border-radius:12px; padding:18px 18px 10px; box-shadow: 0 4px 14px rgba(0,0,0,.06); }
  details { margin: 10px 0; border: 1px solid #eee; border-radius: 10px; background:#fafafa; }
  summary { cursor:pointer; padding: 10px 12px; font-weight: 700; user-select:none; list-style:none; }
  summary::-webkit-details-marker { display:none; }
  summary::before { content:"â–¸"; display:inline-block; width: 18px; color:#666; }
  details[open] summary::before { content:"â–¾"; }
  ul { list-style:none; padding: 0 0 10px 0; margin: 0; }
  li { padding: 6px 12px; }
  a { text-decoration:none; color:#0066cc; }
  a:hover { text-decoration:underline; }
  .muted { color:#777; font-weight:400; margin-left:6px; font-size: 0.9em; }
  .icon { display:inline-block; width: 22px; }
  .nested { padding-left: 14px; }
  .root-files { margin: 6px 0 14px; border: 1px solid #eee; border-radius: 10px; background:#fafafa; }
  .root-files ul { padding-bottom: 6px; }
  .footer { margin-top: 14px; font-size: 0.95em; color:#666; }
</style>
</head>
<body>
  <h1>
    <a href="https://github.com/jwesters/website" target="_blank" rel="noopener noreferrer">
      https://github.com/jwesters/ Website Repo
    </a>
  </h1>
  <p>Auto-generated list of HTML files in this repository (folder tree & sorted).</p>

  <div class="panel">
    <div id="status" class="muted">Loadingâ€¦</div>
    <div id="groups"></div>
    <div id="lastUpdated" class="footer"></div>
  </div>

<script>
(() => {
  const OWNER = "jwesters";
  const REPO  = "website";
  const SITE_URL = `https://${OWNER}.github.io/${REPO}`;
  const API_BASE = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;

  // âœ… Options
  const HIDE_ROOT_INDEX_HTML = true;   // hides "/index.html" only
  const HIDE_ALL_INDEX_HTML  = false;  // hide every ".../index.html" if true

  // âœ… Hide any .html file if "NSFW" appears anywhere in the filename (case-insensitive)
  const HIDE_NSFw_ANYWHERE_IN_FILENAME = true;

  // --- Icon mapping (folder/file keywords -> emoji)
  const ICON_RULES = [
    { re: /(tetris)/i, icon: "ðŸ§±" },
    { re: /(hangman)/i, icon: "ðŸª“" },
    { re: /(maze)/i, icon: "ðŸ§©" },
    { re: /(qr|qrcode)/i, icon: "ðŸ”³" },
    { re: /(wordle|numdle|dle)/i, icon: "ðŸŸ©" },
    { re: /(card|deck)/i, icon: "ðŸƒ" },
    { re: /(clock|time)/i, icon: "â°" },
    { re: /(math|quiz)/i, icon: "âž—" },
    { re: /(game|play)/i, icon: "ðŸŽ®" },
    { re: /(index)/i, icon: "ðŸ " },
  ];
  const DEFAULT_FOLDER_ICON = "ðŸ“";
  const DEFAULT_FILE_ICON   = "ðŸ“„";

  const statusEl = document.getElementById("status");
  const groupsEl = document.getElementById("groups");
  const lastUpdatedEl = document.getElementById("lastUpdated");

  function iconFor(name, isDir) {
    const hit = ICON_RULES.find(r => r.re.test(name));
    if (hit) return hit.icon;
    return isDir ? DEFAULT_FOLDER_ICON : DEFAULT_FILE_ICON;
  }

  // --- Tree model
  // node = { name, path, files: [{name,path}], dirs: Map<string,node> }
  const tree = { name: "", path: "", files: [], dirs: new Map() };

  function getOrCreateDir(parent, dirName, fullPath) {
    if (!parent.dirs.has(dirName)) {
      parent.dirs.set(dirName, { name: dirName, path: fullPath, files: [], dirs: new Map() });
    }
    return parent.dirs.get(dirName);
  }

  function addFileToTree(filePath) {
    const parts = filePath.split("/").filter(Boolean);
    const fileName = parts.pop();
    let node = tree;
    let accum = "";
    for (const dir of parts) {
      accum = accum ? `${accum}/${dir}` : dir;
      node = getOrCreateDir(node, dir, accum);
    }
    node.files.push({ name: fileName, path: filePath });
  }

  function filenameContainsNSFW(filename) {
    return filename.toLowerCase().includes("nsfw");
  }

  function shouldHide(filePath) {
    const lowerPath = filePath.toLowerCase();
    const filename = (filePath.split("/").pop() || "").toLowerCase();

    if (HIDE_ALL_INDEX_HTML && lowerPath.endsWith("/index.html")) return true;
    if (HIDE_ROOT_INDEX_HTML && lowerPath === "index.html") return true;

    if (HIDE_NSFw_ANYWHERE_IN_FILENAME && filenameContainsNSFW(filename)) return true;

    return false;
  }

  // Recursively walk the repo using the Contents API
  async function fetchFiles(path = "") {
    const url = path ? `${API_BASE}/${encodeURIComponent(path)}` : API_BASE;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`GitHub API error: ${res.status} ${res.statusText}`);
    const items = await res.json();

    for (const item of items) {
      if (item.type === "dir") {
        await fetchFiles(item.path);
      } else if (item.type === "file" && item.name.toLowerCase().endsWith(".html")) {
        if (!shouldHide(item.path)) addFileToTree(item.path);
      }
    }
  }

  function sortAlpha(a, b) {
    return a.localeCompare(b, undefined, { sensitivity: "base" });
  }

  function countHtmlInSubtree(node) {
    let count = node.files.length;
    for (const child of node.dirs.values()) count += countHtmlInSubtree(child);
    return count;
  }

  function pruneEmptyDirs(node) {
    // Remove directories that contain no html files anywhere below them
    for (const [name, child] of Array.from(node.dirs.entries())) {
      pruneEmptyDirs(child);
      if (countHtmlInSubtree(child) === 0) node.dirs.delete(name);
    }
  }

  function buildFileList(files) {
    const ul = document.createElement("ul");
    files.sort((a, b) => sortAlpha(a.name, b.name));

    for (const f of files) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = `${SITE_URL}/${f.path}`;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.innerHTML = `<span class="icon">${iconFor(f.path, false)}</span>${f.name}`;
      li.appendChild(a);
      ul.appendChild(li);
    }
    return ul;
  }

  function renderDir(node, openByDefault = false, depth = 0) {
    const details = document.createElement("details");
    details.open = openByDefault;

    const total = countHtmlInSubtree(node);
    const summary = document.createElement("summary");
    summary.innerHTML = `<span class="icon">${iconFor(node.name, true)}</span>${node.name} <span class="muted">(${total})</span>`;
    details.appendChild(summary);

    const wrap = document.createElement("div");
    wrap.className = "nested";

    // Files directly in this folder
    if (node.files.length) {
      wrap.appendChild(buildFileList(node.files));
    }

    // Subfolders
    const subfolderNames = Array.from(node.dirs.keys()).sort(sortAlpha);
    for (const subName of subfolderNames) {
      const child = node.dirs.get(subName);
      wrap.appendChild(renderDir(child, false, depth + 1));
    }

    details.appendChild(wrap);
    return details;
  }

  function buildUI() {
    statusEl.textContent = "";
    groupsEl.innerHTML = "";

    pruneEmptyDirs(tree);

    // Root files (no "Root folder" section â€” just a plain list at top if any)
    if (tree.files.length) {
      const box = document.createElement("div");
      box.className = "root-files";
      box.appendChild(buildFileList(tree.files));
      groupsEl.appendChild(box);
    }

    // Top-level folders
    const topFolders = Array.from(tree.dirs.keys()).sort(sortAlpha);
    for (const name of topFolders) {
      const node = tree.dirs.get(name);
      // closed by default; you can change to true if you want first folder opened
      groupsEl.appendChild(renderDir(node, false, 0));
    }

    const totalCount = tree.files.length + topFolders.reduce((sum, n) => sum + countHtmlInSubtree(tree.dirs.get(n)), 0);
    if (totalCount === 0) {
      statusEl.textContent = "No HTML files found.";
    }
  }

  async function setLastUpdated() {
    // Show the last commit date that touched THIS index.html (matches â€œuploaded to GitHubâ€ best)
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/commits?path=index.html&per_page=1`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`GitHub API error: ${res.status} ${res.statusText}`);
      const data = await res.json();
      const iso = data?.[0]?.commit?.committer?.date || data?.[0]?.commit?.author?.date;
      if (!iso) throw new Error("No commit date found.");

      const d = new Date(iso);
      const formatted = new Intl.DateTimeFormat("en-CA", { year: "numeric", month: "long", day: "numeric" }).format(d);
      lastUpdatedEl.textContent = `Last updated: ${formatted} `;
    } catch (e) {
      console.warn(e);
      lastUpdatedEl.textContent = "Last updated: (unavailable)";
    }
  }

  (async () => {
    try {
      statusEl.textContent = "Loadingâ€¦";
      await fetchFiles("");
      buildUI();
      await setLastUpdated();
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Failed to load files. Check the browser console for details.";
      lastUpdatedEl.textContent = "";
    }
  })();
})();
</script>

</body>
</html>
